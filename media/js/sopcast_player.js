function InitPlayer(){if(detectPlugin()){document.getElementById("SopPlayer").InitPlayer()}}function OnPlay(b,a){if(detectPlugin()){if(document.getElementById("SopPlayer").GetState(1)==0){alert("Player hasn't been initialized!");return}document.getElementById("SopPlayer").SetChannelName(a);document.getElementById("SopPlayer").SetSopAddress(b);document.getElementById("SopPlayer").Play()}else{alert("Please install SopPlayer first.")}}function OnPause(){if(detectPlugin()){document.getElementById("SopPlayer").Pause()}}function OnRestart(){if(detectPlugin()){document.getElementById("SopPlayer").RestartPlayer()}}function OnStop(){if(detectPlugin()){document.getElementById("SopPlayer").Stop()}}var accountSet=0;function SetAccount(b,a){if(detectPlugin()){accountSet=1;document.getElementById("SopPlayer").SetUserAndPasswd(b,a)}}var autoChannelAddr;var autoChannelName;var started=0;var autoTimeID=0;function AutoPlay(b,a){autoChannelAddr=b;autoChannelName=a;if(detectPlugin()){autoTimeID=setInterval("StartPlayer();",1000)}}function StartPlayer(){if(started==0){if(document.getElementById("SopPlayer").GetState(1)==1){started=1;OnPlay(autoChannelAddr,autoChannelName);clearInterval(autoTimeID)}}}var getted=0;var timeout=0;var intID=0;function GetChListLoop(){if(getted==0&&timeout<100000){if(document.getElementById("SopPlayer").GetState(1)==1){var b=document.getElementById("SopPlayer").GetChannelList(0);if(b.length!=0){getted=1;var a="";if(accountSet==1){a=document.getElementById("SopPlayer").GetSubChannelList(0)}document.getElementById("chlist").innerHTML=ParseXMLChList(b,a)}}timeout+=1000}else{if(timeout>=100000){alert("Can not initialize ESopCast!")}else{}clearInterval(intID)}}function OnGetChannelList(){if(detectPlugin()){getted=0;timeout=0;document.getElementById("chlist").innerHTML="<br>Loading channel list...</br>";intID=setInterval("GetChListLoop();",1000)}else{var a=null;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLHTTP")}else{return}}a.onreadystatechange=function(){if(a.readyState==4){document.getElementById("chlist").innerHTML=ParseXMLChList(a.responseText,"")}};a.open("GET","http://www.sopcast.com/chlist.xml",true);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send("")}}function ParseXMLChList(d,e){var c=0;var p=new String();p='<table width="100%" border="0" cellpadding="3" cellspacing="1" bgcolor="eeeeee"><tr align="center" bgcolor="#BBDC49" height="24"><td width="12%"><strong>ID</strong></td><td width="*"><strong>Channel Name</strong></td><td width="20%"><strong>Kbps</strong></td><td width="12%"><strong>Ratio</strong></td></tr>';for(var h=0;h<2;h++){var b;if(h==0){if(accountSet==0||e==""){continue}b=new REXML(e)}else{b=new REXML(d)}var l=b.rootElement.childElements.length;for(var g=0;g<l;g++){var a=b.rootElement.childElements[g];var n=a.childElements.length;var o="";for(var f=0;f<n;f++){var m=a.childElements[f];if(m.type!="element"){continue}if(m.childElement("status").text=="2"){if(c++%2==0){o="#F0e0F0"}else{o="#FFFFFF"}p+='<tr height="22" align="center" bgcolor="'+o+'">';p+="<td>";p+=m.attribute("id");p+="</td>";p+="<td align='left'>";p+="<a href='#' onclick=\"OnPlay('";var k=m.childElement("sop_address");p+=k.childElement("item").text;p+="','";p+=m.childElement("name").text;p+="')\">";p+=m.childElement("name").text;p+="</a>";p+="</td>";p+="<td>";p+=m.childElement("kbps").text;p+="</td>";p+="<td>";p+=m.childElement("user_count").text;p+="</td>";p+="</tr>"}}}}p+="</table>";return p}function GetChild(a,b){for(var c=0;c<a.contents.length;c++){if(a.contents[c].name==b){return a.contents[c]}}}var noinstallerr=0;function detectPlugin(){var b;try{b=document.getElementById("SopPlayer").GetVersion();return true}catch(a){if(noinstallerr==0){alert("You haven't installed SopCast yet. \nPlease click \"OK\", scroll to the bottom of the page and click 'SopPlayer' to download it from the Internet.")}noinstallerr=1;return false}}function REXML(a){this.XML=a;this.rootElement=null;this.parse=REXML_parse;if(this.XML&&this.XML!=""){this.parse()}}function REXML_parse(){var k=new RegExp("<([^>/ ]*)([^>]*)>","g");var l=new RegExp("<([^>/ ]*)([^>]*)>([^<]*)","g");var b="";var h="";var f="";var j="";var n="";var m="";var d=0;var g=null;if(this.XML.length==0){return}var c=this.XML.match(k);var a=this.XML.match(l);var e=0;if(c[0].replace(k,"$1")=="?xml"){e++}for(;e<c.length;e++){h=c[e].replace(k,"$1");j=c[e].replace(k,"$2");f=a[e].replace(l,"$3").replace(/[\r\n\t ]+/g," ");m="";if(h.indexOf("![CDATA[")==0){n="<![CDATA[";m="]]>";b="cdata"}else{if(h.indexOf("!--")==0){n="<!--";m="-->";b="comment"}else{if(h.indexOf("?")==0){n="<?";m="?>";b="pi"}else{b="element"}}}if(m!=""){f="";if(a[e].indexOf(m)>-1){f=a[e]}else{for(;e<c.length&&a[e].indexOf(m)==-1;e++){f+=a[e]}f+=a[e]}if(f.substring(n.length,f.indexOf(m))!=""){g.childElements[g.childElements.length]=new REXML_XMLElement(b,"","",g,f.substring(n.length,f.indexOf(m)));if(b=="cdata"){g.text+=f.substring(n.length,f.indexOf(m))}}if(f.indexOf(m)+m.length<f.length){g.childElements[g.childElements.length]=new REXML_XMLElement("text","","",g,f.substring(f.indexOf(m)+m.length,f.length));if(b=="cdata"){g.text+=f.substring(f.indexOf(m)+m.length,f.length)}}continue}if(f.replace(/ */,"")==""){f=""}if(c[e].substring(1,2)!="/"){if(d==0){g=this.rootElement=new REXML_XMLElement(b,h,j,null,f);d++;if(f!=""){g.childElements[g.childElements.length]=new REXML_XMLElement("text","","",g,f)}}else{if(c[e].substring(c[e].length-2,c[e].length-1)!="/"){g=g.childElements[g.childElements.length]=new REXML_XMLElement(b,h,j,g,f);d++;if(f!=""){g.childElements[g.childElements.length]=new REXML_XMLElement("text","","",g,f)}}else{g.childElements[g.childElements.length]=new REXML_XMLElement(b,h,j,g,f);if(f!=""){g.childElements[g.childElements.length]=new REXML_XMLElement("text","","",g,f)}}}}else{g=g.parentElement;d--;if(g&&f!=""){g.text+=f;g.childElements[g.childElements.length]=new REXML_XMLElement("text","","",g,f)}}}}function REXML_XMLElement(c,b,e,d,a){this.type=c;this.name=b;this.attributeString=e;this.attributes=null;this.childElements=new Array();this.parentElement=d;this.text=a;this.getText=REXML_XMLElement_getText;this.childElement=REXML_XMLElement_childElement;this.attribute=REXML_XMLElement_attribute}function REXML_XMLElement_getText(){if(this.type=="text"||this.type=="cdata"){return this.text}else{if(this.childElements.length){var a="";for(var b=0;b<this.childElements.length;b++){a+=this.childElements[b].getText()}return a}else{return""}}}function REXML_XMLElement_childElement(a){for(var b=0;b<this.childElements.length;b++){if(this.childElements[b].name==a){return this.childElements[b]}}return null}function REXML_XMLElement_attribute(e){if(!this.attributes){var a=new RegExp(" ([^= ]*)=","g");if(this.attributeString.match(a)&&this.attributeString.match(a).length){var c=this.attributeString.match(a);if(!c.length){c=null}else{for(var b=0;b<c.length;b++){c[b]=new Array((c[b]+"").replace(/[= ]/g,""),ParseAttribute(this.attributeString,(c[b]+"").replace(/[= ]/g,"")))}}this.attributes=c}}if(this.attributes){for(var d=0;d<this.attributes.length;d++){if(this.attributes[d][0]==e){return this.attributes[d][1]}}}return""}function ParseAttribute(c,a){var c=c+">";if(c.indexOf(a+"='")>-1){var b=new RegExp(".*"+a+"='([^']*)'.*>")}else{if(c.indexOf(a+'="')>-1){var b=new RegExp(".*"+a+'="([^"]*)"(.|\n|\r)*>')}}return c.replace(b,"$1")};